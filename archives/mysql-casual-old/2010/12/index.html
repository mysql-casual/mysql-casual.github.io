<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type 5.02" />
<link rel="stylesheet" href="http://mysql-casual.org/styles.css" type="text/css" />
<link rel="start" href="http://mysql-casual.org/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="http://mysql-casual.org/atom.xml" />
<script type="text/javascript" src="http://mysql-casual.org/mt.js"></script>


    <title>MySQL Casual: 2010年12月アーカイブ</title>


    <link rel="prev" href="http://mysql-casual.org/2010/11/" title="2010年11月" />
    <link rel="next" href="http://mysql-casual.org/2011/07/" title="2011年7月" />

</head>
<body id="classic-blog" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">


            <div id="header-name"><a href="http://mysql-casual.org/" accesskey="1">MySQL Casual</a></div>
            <div id="header-description"></div>

        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">2010年12月アーカイブ</h1>





                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000014"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/14"
    dc:title="MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000014"
    dc:subject=""
    dc:description="こんにちはこんにちは！各プログラミング言語のAdvent Calendarが盛り..."
    dc:creator="myfinder"
    dc:date="2010-12-25T00:00:01+09:00" />
</rdf:RDF>
-->

<div id="entry-14" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-advent-calendar-2010.html" rel="bookmark">MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-25T00:00:01+09:00">2010年12月25日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-advent-calendar-2010.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-advent-calendar-2010.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            こんにちはこんにちは！<div><br /></div><div><a href="http://gihyo.jp/news/info/2010/12/0102">各プログラミング言語のAdvent Calendar</a>が盛り上がってきているところですが、MySQLのAdvent Calendarがあってもいいじゃないかと思い立ってチャレンジすることにしました。</div><div><br /></div><meta charset="utf-8"><div>今更聞けないような事や、ちょっとした疑問を共有したりするために始めたMySQL Casualですので、ｽｰﾊﾟｰﾊｶｰの方から見たら「おいおいそんな事も知らないのかよ」とか「それは違うよ」というような内容もあるかもしれませんが、そういう時にはご指摘いただけると広く知識を共有できるので大変ありがたく思います。</div><div><br /></div><div>記事の前提となる環境は特に断りがない場合下記だと思ってください。</div><div><br /></div><div>OS: MacOSX Snow Leopard or CentOS5</div><div>Package:&nbsp;mysql-5.1.53-osx10.6-x86_64.dmg or&nbsp;MySQL-server-5.1.53-1.glibc23.x86_64.rpm</div><div><br /></div><div>環境の違いで変わる点についてはそれほど詳しくないので、ご存知の方は是非つっこみをいただけるとありがたいです。</div><div><br /></div><div>これから下記に、1日1本記事を書いたらリンクを張って行きます。</div><div><br /></div><div><div><ul><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-01.html">2010-12-01(水)</a>&nbsp;mysqld_safeって何だ</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-02.html">2010-12-02(木)</a> showコマンド</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-03.html">2010-12-03(金)</a> ユーザ設定入門<br /></li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-04.html">2010-12-04(土)</a>&nbsp;old_passwordsオプション</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-05.html">2010-12-05(日)</a>&nbsp;show profileでフェーズごとの実行時間を見る</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-06.html">2010-12-06(月)</a>&nbsp;コマンドプロンプト表示をカスタマイズ</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-07.html">2010-12-07(火)</a>&nbsp;クエリの結果をHTMLで取る</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-08.html">2010-12-08(水)</a>&nbsp;同期I/OまたはO_DIRECTって何だ？</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-09.html">2010-12-09(木)</a>&nbsp;InnoDBにおけるデータ保全とO_DIRECTのこと</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-10.html">2010-12-10(金)</a>&nbsp;クエリログを吐かせたくないけど実行されているクエリを追いたいとき</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-11.html">2010-12-11(土)</a>&nbsp;MySQL Casual Talks Vol.1 開催です</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-12.html">2010-12-12(日)</a>&nbsp;MySQL Casual Talks Vol.1 開催報告</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-13.html">2010-12-13(月)</a>&nbsp;クエリログもバイナリログも吐いてないけど実行されているクエリを追いたいとき</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-14.html">2010-12-14(火)</a>&nbsp;rootのパスワードを忘れてしまったら</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-15.html">2010-12-15(水)</a>&nbsp;AUTOCOMMITを常にOFFする</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-16.html">2010-12-16(木)</a>&nbsp;テーブルのデータとインデックスのサイズを知りたいとき</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-17.html">2010-12-17(金)</a>&nbsp;fdatasyncとO_DSYNC</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-18.html">2010-12-18(土)</a>&nbsp;古いバージョンのMySQLが欲しいとき</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-19.html">2010-12-19(日)</a>&nbsp;Q4Mの自動compactionが効いていないときの対応</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-20.html">2010-12-20(月)</a>&nbsp;レプリケーション対象を絞りたいとき</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-21.html">2010-12-21(火)</a>&nbsp;auto_incrementでマスタ分割をがんばりたいとき</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-22.html">2010-12-22(水)</a>&nbsp;mysqlslapでさくっと性能を確かめる</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-23.html">2010-12-23(木)</a>&nbsp;リモートのMySQLの出力結果を加工したい</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-24.html">2010-12-24(金)</a>&nbsp;datediffについて</li><li><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-25.html">2010-12-25(土)</a>&nbsp;MySQLのビルドオプションを後から知りたいとき</li></ul></div></div><div><br /></div><div>はたして25本続けられるのでしょうか。</div><div>がんばってみます。</div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000039"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/39"
    dc:title="MySQLのビルドオプションを後から知りたいとき - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000039"
    dc:subject=""
    dc:description="なんだかんだで25日経ちました。今日が最後です。最後だからといって、特別でもなん..."
    dc:creator="myfinder"
    dc:date="2010-12-25T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-39" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-25.html" rel="bookmark">MySQLのビルドオプションを後から知りたいとき - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-25T00:00:00+09:00">2010年12月25日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-25.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-25.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            なんだかんだで25日経ちました。今日が最後です。<div>最後だからといって、特別でもなんでもないネタですが MySQL のビルドオプションを知りたい事がある瞬間が来るかもしれません。</div><div>例えば誰かから引き継いだ MySQL の運用で、マスタ切替で引っ越ししたりする際などに configure オプションをあわせたいときなどは、特に需要があると思います。</div><div><br /></div><div>そんな時は mysqlbug コマンドを使うとお手軽でよいです。</div><div><br /></div><div>この mysqlbug コマンドは、そもそもバグレポートを作成するためのものですが、そのレポートに記載される項目に configure で指定された内容が含まれているのです。</div><div><br /></div><div>やり方は簡単で、下記の通りでさくっと取得できます。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>$ strings /usr/bin/mysqlbug | grep configure</div></div></blockquote><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div># This is set by configure</div></div><div><div>CONFIGURE_LINE="./configure &nbsp;'--with-mysqld-ldflags=-static' '--with-client-ldflags=-static' '--enable-assembler' '--enable-local-infile' '--with-fast-mutexes' '--with-mysqld-user=mysql' '--with-unix-socket-path=/var/lib/mysql/mysql.sock' '--with-pic' '--prefix=/' '--with-extra-charsets=complex' '--with-ssl' '--exec-prefix=/usr' '--libexecdir=/usr/sbin' '--libdir=/usr/lib64' '--sysconfdir=/etc' '--datadir=/usr/share' '--localstatedir=/var/lib/mysql' '--infodir=/usr/share/info' '--includedir=/usr/include' '--mandir=/usr/share/man' '--enable-thread-safe-client' '--with-comment=MySQL Community Server (GPL)' '--with-readline' '--with-zlib-dir=bundled' '--without-plugin-ndbcluster' '--with-plugin-innobase' '--without-plugin-innodb_plugin' '--with-plugin-partition' '--with-plugin-csv' '--with-plugin-archive' '--with-plugin-blackhole' '--with-plugin-federated' '--without-plugin-daemon_example' '--without-plugin-ftexample' '--with-embedded-server' '--with-big-tables' '--enable-shared' 'CC=gcc' 'CFLAGS=-O2 -g -pipe' 'LDFLAGS=' 'CXX=gcc' 'CXXFLAGS=-O2 -g -pipe -felide-constructors -fno-exceptions -fno-rtti '"</div></div></blockquote><div><br /></div><div>この例では Oracle が配布している rpm の 5.1.51 を使っていますが、各バージョンや、他の団体が配布しているものによって(例えば Linux のディストリビューション)違いがあるので、皆さんも手元の環境で一度確認してみてはいかがでしょうか。</div><div><br /></div><div>詳細は<a href="http://dev.mysql.com/doc/refman/5.1/ja/bug-reports.html">マニュアル</a>を見るとよいでしょう。</div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000038"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/38"
    dc:title="datediffについて - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000038"
    dc:subject=""
    dc:description="みなさんこんにちは。さとうようぞうです。 twitterアカウントは yoozo..."
    dc:creator="myfinder"
    dc:date="2010-12-24T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-38" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-24.html" rel="bookmark">datediffについて - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-24T00:00:00+09:00">2010年12月24日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-24.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-24.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>みなさんこんにちは。さとうようぞうです。<br />
twitterアカウントは <a href="http://twitter.com/yoozoosato">yoozoosato</a> 、年齢は35歳、日齢でいうと13024日の独身です。可愛い彼女を常に募集中です。<br />
advent calendarを書くのはこれが初めてですが、 <a href="http://twitter.com/myfinder">@myfinder</a> さんに「何でもいいですよ」と言われたので書いてみることにしました。</p>

<p>テーマはmysqlの日付関数、datediffについてです。<br />
詳細はmysqlの <a href="http://dev.mysql.com/doc/refman/4.1/ja/date-and-time-functions.html">リファレンスマニュアル</a> を参照してください。</p>

<p>さて、冒頭で書いた私の日齢ですが、日数の計算というのは一見簡単に求められそうで実は色々な落とし穴があります。日の差分が数日、そう、3日とか10日程度であればさほど問題にはならないのですが、年をまたぐような差があったりすると閏年の問題があったり、小さい単位で言うと月をまたぐだけで「先月は31日まであったか？」などの細かい問題が起こるので、全てを自前処理で計算するのはなかなか難しいです。<br />
なので、各プログラム言語で提供されている日付関連の組込み関数や標準ライブラリを使うことが多いでしょう。というか、それらを使うべきです。</p>

<p>例えばrubyであれば標準ライブラリのTimeクラスが使えます。<br />
前述した私の日齢計算をTimeクラス使ってやってみるとこんな感じですかね。</p>



<pre>
irb(main):001:0&gt; now = Time.new
=&gt; Fri Dec 24 00:47:56 +0900 2010
irb(main):002:0&gt; date_of_birth = Time.local(1975, 4, 28, 0, 0, 0)
=&gt; Mon Apr 28 00:00:00 +0900 1975
irb(main):003:0&gt; diff = now - date_of_birth
=&gt; 1125276476.12027
irb(main):004:0&gt; puts (diff / 60 / 60 / 24).round
13024
</pre>



<p>さて、本題のmysqlのお話。<br />
もちろんmysqlでも日付関連の関数が多数提供されているので、積極的に使いましょう。<br />
datediff関数を使うと、指定した２つの日付間の差を求めることができます。前述した私の日齡は以下のsqlで求めました。</p>



<pre>
mysql&gt; select datediff(now(), '1975/04/28');
+-------------------------------+
| datediff(now(), '1975/04/28') |
+-------------------------------+
|                         13024 |
+-------------------------------+
1 row in set (0.00 sec)
</pre>



<p>簡単ですね、短いですね。簡潔ですね！<br />
さきほどのrubyの例よりもめちゃくちゃシンプルです。</p>

<p>「それがどうした、いつ使えばいいの？」と思われるかもしれませんが、私が携わった案件では集計系の処理で、2週間以上ログインしていない人、のような抽出に使ってました。</p>



<pre>
select user_id from accounts where datediff(now(), last_access_date) &gt; 14;
</pre>



<p>もちろん、このSQLを発行するプログラムで「2週間前」の日付をプログラムで計算しておき、以下のようなクエリに置き換えることも可能です。</p>



<pre>
select user_id from accounts where last_access &gt; [CALC_RESULT]
</pre>



<p>でも、SQLのwhere句内に明示的に「そのクエリで実行したい内容」が明示的に書いてある方が直感的に分かりやすいので、私は好きです。</p>


<p>ところで巷では某宗派の方々がとある聖なる君の誕生日を祝う準備でバタバタと忙しいようですね。<br />
いや、その宗派で無い人たちが空騒ぎしているだけという説も無いわけではないですが。<br />
そういえば聖なる君の誕生日って、いつでしたっけ？あと何日あるのか、mysqlにクエリを発行してみましょうか。</p>



<pre>
mysql&gt; select datediff('2012/12/25', now());
+-------------------------------+
| datediff('2012/12/25', now()) |
+-------------------------------+
|                           732 |
+-------------------------------+
1 row in set (0.00 sec)
</pre>



<p>まだ732日もあるよ！！</p>

<p>それではみなさん、また730日後くらいのadvent calendarでお会いしましょう！</p>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000037"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/37"
    dc:title="リモートのMySQLの出力結果を加工したい - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000037"
    dc:subject=""
    dc:description="通常 MySQL の出力結果を CSV にしたいと思ったら、「into outf..."
    dc:creator="myfinder"
    dc:date="2010-12-23T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-37" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-23.html" rel="bookmark">リモートのMySQLの出力結果を加工したい - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-23T00:00:00+09:00">2010年12月23日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-23.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-23.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>通常 MySQL の出力結果を <span class="caps">CSV </span>にしたいと思ったら、「into outfile 〜 fields terminated by」を使うと思います。<br />
が、これでは MySQL が動作しているサーバのローカルにファイルを出力することになります。<br />
全部が一つのサーバだったり、あるいは自分の管理サーバであればそのあと scp すればよいだけですが、レンタルサーバの環境だったりしたときには MySQL が動作しているサーバのローカルにファイルを吐けなかったりします。</p>

<p>かといって、下記のような出力をいじくるのは大変骨が折れます。</p>



<pre>
$ mysql -umysql-casual -p -hmysql mysql-casual -e 'select author_id, author_basename, author_name from author'
+-----------+-----------------+------------------+
| author_id | author_basename | author_name      |
+-----------+-----------------+------------------+
|         1 | myfinder        | Tatsuro Hisamori | 
|         2 | riywo           | Ryosuke Iwanaga  | 
+-----------+-----------------+------------------+
</pre>



<p>そういうときは、mysql コマンドの出力結果をパイプに渡すと、タブ区切りで出してくれるので加工が楽になります。</p>



<pre>
$ mysql -umysql-casual -p -hmysql mysql-casual -e 'select author_id, author_basename, author_name from author' | less
author_id       author_basename author_name
1       myfinder        Tatsuro Hisamori
2       riywo   Ryosuke Iwanaga
</pre>



<p>という感じに。<br />
タブ区切りなので、このまま保存してもよいですし、Perlに渡していろいろ加工するのもアリでしょう。</p>



<pre>
$ mysql -umysql-casual -p -hmysql mysql-casual -e 'select author_id, author_basename, author_name from author' |  perl -pe 'tr/\t/,/'       
author_id,author_basename,author_name,author_created_by
1,myfinder,Tatsuro Hisamori,NULL
2,riywo,Ryosuke Iwanaga,1
</pre>


<p><small> *これだとCSV変換としては不十分ですがあくまで例:p</small></p>

<p>この出力の違いは <a href="http://archive.linux.or.jp/JM/html/LDP_man-pages/man3/isatty.3.html">isatty関数</a> で判定して、パイプの場合はタブで出すようになっているようです。<br />
この出力カスタマイズできたらいいな〜と思うのですが、MySQL 本体にはそういった機能はなさそうです。</p>

<p>なので、出力を加工したい時はパイプから Perl とかに渡すのが Casual でよいかなと思います。</p>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000036"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/36"
    dc:title="mysqlslapでさくっと性能を確かめる - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000036"
    dc:subject=""
    dc:description="MySQL の性能チェックはいろいろな切り口&amp;amp;方法がありますが、標準で付..."
    dc:creator="myfinder"
    dc:date="2010-12-22T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-36" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-22.html" rel="bookmark">mysqlslapでさくっと性能を確かめる - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-22T00:00:00+09:00">2010年12月22日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-22.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-22.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            MySQL の性能チェックはいろいろな切り口&amp;方法がありますが、標準で付属しているツールに mysqlslap があります。<div>mysqlslap を使うと、同時接続数と投げるクエリ数を指定するだけで後は適当なクエリを発行してくれるので、ざっくりと投げたクエリあたりの処理性能を見ることができます。</div><div><br /></div><div>実行するとこんな感じです。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>$ mysqlslap --user=root --password= --host=localhost --port=3306 --concurrency=10 --iterations=1 --engine=innodb --auto-generate-sql --auto-generate-sql-load-type=write --number-of-queries=10000</div></div><div><div>Benchmark</div></div><div><div><br /></div>Running for engine innodb</div><div>Average number of seconds to run all queries: 1.592 seconds</div><div>Minimum number of seconds to run all queries: 1.592 seconds</div><div>Maximum number of seconds to run all queries: 1.592 seconds</div><div>Number of clients running queries: 10<span class="Apple-tab-span" style="white-space:pre">	</span></div><div>Average number of queries per client: 1000</div></blockquote><div><br /></div><div>この場合、InnoDB ストレージエンジンのテーブルに対して並列度10で10000クエリを投げた場合の処理時間についてのレポートが出てきます。</div><div>オプションを加えると、クエリを自分で指定する事も可能です。</div><div>詳しい事は<a href="http://dev.mysql.com/doc/refman/5.1/ja/mysqlslap.html">マニュアル</a>に書いてあります。</div><div><br /></div><div>設定を変更したらどのくらい早くなるか、などを試す際には、このコマンドを使うのが楽でいいと思います。</div><div><br /></div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000035"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/35"
    dc:title="auto_incrementでマスタ分割をがんばりたいとき - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000035"
    dc:subject=""
    dc:description="ソーシャルゲームのためのMySQL入門では、採番用のテーブルを別途用意することで..."
    dc:creator="myfinder"
    dc:date="2010-12-21T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-35" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-21.html" rel="bookmark">auto_incrementでマスタ分割をがんばりたいとき - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-21T00:00:00+09:00">2010年12月21日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-21.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-21.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <a href="http://engineer.dena.jp/2010/11/mysql-for-socialgame.html">ソーシャルゲームのためのMySQL入門</a>では、採番用のテーブルを別途用意することでマスタ分割に対応できるよね〜という話がありましたが、「auto_incrementな状況から移行するのはな〜」と思うauto_increment厨な方もいらっしゃるのではないでしょうか。<div><br /></div><div>そんなときは、「auto_increment_increment」と「auto_increment_offset」の設定で乗り切る方法もあります。</div><div><br /></div><div>例えば2台構成にしたい場合、同構成のサーバを2台(今回はdb1,2とします)用意し、my.cnfに</div><div><br /></div><div><ul><li>db1</li></ul></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div><div>auto_increment_increment=2</div></div></div><div><div><div>auto_increment_offset=1</div></div></div></blockquote><div><div><br /></div><div><ul><li>db2</li></ul></div></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div><div>auto_increment_increment=2</div></div></div><div><div><div>auto_increment_offset=2</div></div></div></blockquote><div><br /></div><div>という設定をしておきます。</div><div>そうするとそれぞれのサーバで払い出されるIDの重複を避ける事ができます。</div><div>3台でやる場合はauto_increment_incrementを3に、auto_increment_offsetをそれぞれ1,2,3と3台に振ればよいでしょう。</div><div><br /></div><div><br /></div><div>ただ、このやり方の場合分散するテーブル全てにauto_incrementが設定されていないと意味がないので、運用が面倒になるかもしれません。</div><div>やはり素直に採番テーブルを作るか、あるいはMySQL以外のプロダクトを[使|作]って払い出すようにした方が融通が利く面は大きいんじゃと思います。</div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000034"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/34"
    dc:title="レプリケーション対象を絞りたいとき - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000034"
    dc:subject=""
    dc:description="レプリケーションはマスタサーバが binlog に吐いた内容が転送されるので、b..."
    dc:creator="myfinder"
    dc:date="2010-12-20T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-34" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-20.html" rel="bookmark">レプリケーション対象を絞りたいとき - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-20T00:00:00+09:00">2010年12月20日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-20.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-20.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <div>レプリケーションはマスタサーバが binlog に吐いた内容が転送されるので、binlog に吐きたいDBやテーブルが決まっている場合はログオプションを使います。</div><div>また、スレーブ側でも受信したログのうちどれを適用するかということについて制御でき、その場合はreplicate-*オプションを使うことになります。</div><div><br /></div><div><ul><li><font class="Apple-style-span" style="font-size: 1.25em; ">マスタでの binlog 制御</font></li></ul></div><div>「binlog-do-db」と「binlog-ignore-db」で設定します。</div><div>例えば mysql データベースについて明示的に出さないようにするには</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>binlog-ignore-db=mysql</div></blockquote><div><br /></div><div>としておけばよいでしょう。</div><div>ユーザやエントリでマスタ分割が進んでいる場合、1サーバ1DBだったりすると思うので、そういうときは明示的に</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>binlog-do-db=entry</div></blockquote><div><br /></div><div>などを指定しておけばよいでしょう。</div><div>マスタで不要なログを吐かないようにすれば、binlog のディスク使用量を抑えられ、転送量も少なくできるのでエコですね。</div><div><br /></div><div><ul><li><font class="Apple-style-span" style="font-size: 1.25em; ">スレーブでのレプリ制御</font></li></ul></div><div>スレーブ側では受け取った binlog から適用する内容を設定できます。</div><div>例えばマスタでから受け取ったログのうち entry だけをレプリしたい場合は</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>replicate-do-db=entry</div></blockquote><div><br /></div><div>と書いておきます。</div><div>逆に、entry だけを適用したくない場合</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>replicate-ignore-db=entry</div></blockquote><div><br /></div><div>としておきます。</div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000033"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/33"
    dc:title="Q4Mの自動compactionが効いていないときの対応 - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000033"
    dc:subject=""
    dc:description="Q4M も 0.9.4 でだいぶ安定的に運用できるようになり、数万 QPS の環..."
    dc:creator="myfinder"
    dc:date="2010-12-19T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-33" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-19.html" rel="bookmark">Q4Mの自動compactionが効いていないときの対応 - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-19T00:00:00+09:00">2010年12月19日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-19.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-19.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            Q4M も 0.9.4 でだいぶ安定的に運用できるようになり、数万 QPS の環境に投じても安定して稼働するという話もあるようです。<div>しかしながら、queue テーブルの自動 compaction が効かない事があり、.Q4Mファイルがディスク領域を圧迫することがあります。</div><div>そういうときは手動で compaction してあげることで対応できます。</div><div><br /></div><div>手動でやる前に確認するべきこととして、compaction が行われる時にはログにそういったメッセージが出るので、.Q4M が肥大したときはいつから compaction が行われていないかを把握しておきましょう。</div><div><br /></div><meta charset="utf-8"><div>compaction 中はI/Oが多分に発生するので、compaction 対象テーブル以外への　enqueue が走っている場合は、別のサーバに同じ構成の Q4M を用意してそちらへ参照を向けてから実行しないと、処理が詰まって障害になる可能性があります。</div><div><br /></div><div>もし、2台も用意できないという場合は、queue_concurrent_compaction_interval を数十kbとか十分に小さくして、compaction のペースを下げた方がよいです。</div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000032"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/32"
    dc:title="古いバージョンのMySQLが欲しいとき - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000032"
    dc:subject=""
    dc:description="「やべ、担当になったサービスの MySQL が4.0系だ！しかも Master ..."
    dc:creator="myfinder"
    dc:date="2010-12-18T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-32" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-18.html" rel="bookmark">古いバージョンのMySQLが欲しいとき - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-18T00:00:00+09:00">2010年12月18日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-18.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-18.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            「やべ、担当になったサービスの MySQL が4.0系だ！しかも Master のサーバが老朽化しているから切り替えで移行しなきゃ！でも MySQL の rpm 無くなっちゃってるしどうしよう」<div>というようなシーンに出くわす方もいらっしゃるのではないかと思います。</div><div><br /></div><div>バージョンアップができる状況ならばよいですが、検証にものすごい時間がかかってしまう事が見込まれる場合、できれば同系統のバージョンの切り替え先を用意したくなることでしょう。</div><div><br /></div><div>そんなときは&nbsp;<a href="http://rpm.pbone.net/">http://rpm.pbone.net/</a> を使って探すとよいでしょう。</div><div><a href="http://rpm.pbone.net/index.php3/stat/2/simple/2">Advanced RPM Search</a>&nbsp;を使うとディストリビューションごとに検索できるのでより便利です。</div><div><br /></div><div>例えば「mysql-server」で検索した場合</div><div>&nbsp;- 6.0</div><meta charset="utf-8"><div>&nbsp;- 5.5</div><meta charset="utf-8"><div>&nbsp;- 5.4</div><div>&nbsp;- 5.1</div><div>&nbsp;- 5.0</div><div>&nbsp;- 4.1</div><div>&nbsp;- 4.0</div><div>&nbsp;- 3.23</div><div>&nbsp;- 3.22</div><div>の rpm が引っかかります。つい先日GAリリースされた5.5.8も手に入ります、対応早いですね。</div><div><br /></div><div>この調子で client 等も検索して入手できれば、今しばらく古いバージョンのままでもハードの乗り換えで生き残って行けるんではと思います。</div><div><br /></div><div>あるいは、各バージョンそろっているので時間と予算が許せば 3.23 -&gt; 4.0 -&gt; 4.1 -&gt; 5系といったような感じでちょっとずつ Master のバージョンを上げていくといったことも可能になるかと思います。</div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000031"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/31"
    dc:title="fdatasyncとO_DSYNC - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000031"
    dc:subject=""
    dc:description="MySQL 5.5がリリースされたというのに InnoDB ネタですいません。今..."
    dc:creator="myfinder"
    dc:date="2010-12-17T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-31" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-17.html" rel="bookmark">fdatasyncとO_DSYNC - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-17T00:00:00+09:00">2010年12月17日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-17.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-17.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            MySQL 5.5がリリースされたというのに InnoDB ネタですいません。<div>今日は、以前 InnoDB 関係のエントリで O_DIRECT とかについて書いたときに疑問だった点についてです。</div><div><br /></div><div>fdatasync と&nbsp;O_DSYNC&nbsp;の違いがいまいちわからず、同僚の方に質問したりなどしてみたのですが今ひとつ腹に落ちずもやっとした感じだったのですが、「<a href="http://www.amazon.co.jp/%E5%AE%9F%E8%B7%B5%E3%83%8F%E3%82%A4%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9MySQL-%E7%AC%AC2%E7%89%88-Baron-Schwartz/dp/4873114268">実践ハイパフォーマンスMySQL 第二版</a>」にその答えを見つけられました。</div><meta charset="utf-8"><div><br /></div><div><ul><li><font class="Apple-style-span" style="font-size: 1.25em; ">fdatasync</font></li></ul></div><div>これを指定すると、fsync 関数で flush するということは以前エントリに挙げたわけですが、これはもともと fdatasync 関数を使っていたところを fsync に置き換えた経緯があるからのようです。</div><div>で、fsync がどういう挙動になるかという話なのですが、これを使う場合 I/O は OS ごとの実装にお任せになるので、例えば「WebサーバとDBが同居していて、そもそもバッファプールを小さくしている場合などには有効な場合もあるだろげ」ということでした。</div><div><br /></div><div><meta charset="utf-8"><div><ul style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.75em; margin-left: 20px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-weight: normal; list-style-type: disc; list-style-position: outside; list-style-image: initial; background-repeat: no-repeat repeat; "><li style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-weight: normal; "><font class="Apple-style-span" size="3">O_DSYNC</font></li></ul></div></div><div>では O_DSYNC の場合はというと、open 関数の呼び出しに O_SYNC フラグをつけ、全書き込みを同期させる挙動になります。</div><div>O_DSYNC というフラグもあるようですが、これは fdatasync 同様に O_DSYNC から O_SYNC に置き換えたためにこうなったということです。</div><div>O_SYNC は書き込みをまずページキャッシュに行い、その後ディスクにも行うのですが、この際に呼び出し元プロセスをブロックします。</div><div>本には更に、これを指定した場合ハードウェアにも「同期するぞ」と指示を送ってキャッシュさせない可能性があったりするという話でした。</div><div><br /></div><div><meta charset="utf-8"><div><div><ul style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.75em; margin-left: 20px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-weight: normal; list-style-type: disc; list-style-position: outside; list-style-image: initial; border-style: initial; border-color: initial; background-repeat: no-repeat repeat; "><li style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-weight: normal; border-style: initial; border-color: initial; "><font class="Apple-style-span" size="3">結論</font></li></ul></div></div></div><div>MySQL 以外のプロセスが動いているので I/O について OS によしなにお任せしたいなーという場合は &nbsp;fdatasync を指定し、そうでない場合は O_DIRECT を設定して、InnoDB のチューニングをがんばるのがよい選択と言えそうです。</div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000030"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/30"
    dc:title="テーブルのデータとインデックスのサイズを知りたいとき - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000030"
    dc:subject=""
    dc:description="パフォーマンスチューニングのために、テーブルのデータがそもそもメモリに乗るのか知..."
    dc:creator="myfinder"
    dc:date="2010-12-16T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-30" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-16.html" rel="bookmark">テーブルのデータとインデックスのサイズを知りたいとき - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-16T00:00:00+09:00">2010年12月16日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-16.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-16.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            パフォーマンスチューニングのために、テーブルのデータがそもそもメモリに乗るのか知りたいことは多いと思います。<div>テーブル単位であれば show table status の data_length と index_length を見ればわかりますが、パーティショニングしている場合、パーティション単位の data_length や index_length を見たくなることでしょう。</div><div><br /></div><div>そんなときは information_schema の partitions を参照することで、その容量を知る事ができます。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>mysql&gt; use information_schema;</div></div><div><div>mysql&gt; select partition_name,data_length,index_length from partitions where table_name = 'target_table_name';</div></div><div><div>+----------------+----------+-----------+</div></div><div><div>| &nbsp; &nbsp;partition_name &nbsp; &nbsp;| data_length | index_length |</div></div><div><div>+----------------+----------+-----------+</div></div><div><div>| p1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 5988417 &nbsp; | &nbsp; 3060793 &nbsp; &nbsp;|</div></div><div><div>| p2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 7078936 &nbsp; | &nbsp; 3640655 &nbsp; &nbsp;|</div></div><div><div>| p3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 3238002 &nbsp; | &nbsp; 1590689 &nbsp; &nbsp;|</div></div><div><div>| p4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 5661261 &nbsp; | &nbsp; 2867855 &nbsp; &nbsp;|</div></div><div><div>| p5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 7976517 &nbsp; | &nbsp; 4108320 &nbsp; &nbsp;|</div></div><div><div>+----------------+----------+-----------+</div></div><div><div>5 rows in set (0.48 sec)</div></div></blockquote><div><br /></div><div>data_length と index_length は byte 単位なので、必要に応じて 1/1000 などして見た方がわかりやすいです。</div><div><br /></div><div>通常はテーブル単位の情報で事足りると思います。</div><div>が、データだけで数十GBになるような巨大テーブルがある場合、いちパーティションの data_length + index_length がメモリに乗り切らなくなる事態が起こりえます、そういった状況を把握しようとする際に、この information_schema.partitions は役立つのではないでしょうか。</div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000029"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/29"
    dc:title="AUTOCOMMITを常にOFFする - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000029"
    dc:subject=""
    dc:description="新たにDBやテーブルを作る場合 InnoDB を基本的に使うかと思うのですが、状..."
    dc:creator="myfinder"
    dc:date="2010-12-15T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-29" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-15.html" rel="bookmark">AUTOCOMMITを常にOFFする - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-15T00:00:00+09:00">2010年12月15日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-15.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-15.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            新たにDBやテーブルを作る場合 InnoDB を基本的に使うかと思うのですが、状況によっては更に自動的に AUTOCOMMIT を OFF にしたいという要望もあったりするのではないでしょうか。<div>そういうときは、 WAF や O/Rマッパ的なレイヤで吸収するのもありですが、 my.cnf に書いてしまうというのも手です。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>[mysqld]</div></div><div><div>init_connect='SET AUTOCOMMIT=0'</div></div></blockquote><div><br /></div><div>という風にして書いておいてMySQLを再起動し、接続後に確認すると。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>mysql&gt;SELECT @@autocommit;</div><div><div>+--------------+</div></div><div><div>| @@autocommit |</div></div><div><div>+--------------+</div></div><div><div>| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 |</div></div><div><div>+--------------+</div></div><div><div>1 row in set (0.00 sec)</div></div></blockquote><div><br /></div><div>という感じでいけます。</div><div>但し grant する際に *.* を指定した場合はそのユーザに super 権限がつき、 init_connect が無視されるので注意が必要です。</div><div>監視系の参照や、DBそのものに対するメンテナンスでもなければ、root等の権限でDBへアクセスすることも無いと思うので、それほど神経質になる必要は無いと思いますが、覚えておかないとハマりがちなので注意したいところです。</div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000028"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/28"
    dc:title="rootのパスワードを忘れてしまったら - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000028"
    dc:subject=""
    dc:description="MySQL の root ユーザのパスワードを忘れてしまった！というときは、 -..."
    dc:creator="myfinder"
    dc:date="2010-12-14T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-28" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-14.html" rel="bookmark">rootのパスワードを忘れてしまったら - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-14T00:00:00+09:00">2010年12月14日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-14.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-14.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <div>MySQL の root ユーザのパスワードを忘れてしまった！というときは、 --skip-grant-tables オプションを起動引数につけるか、 my.cnf に</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><meta charset="utf-8"><div>[mysqld]</div><div><div>skip-grant-tables</div></div></div></blockquote><div><br /></div><div>という記述をして起動すれば、 -p オプションなしに root ユーザで入れます。</div><div>その後</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>mysql&gt; UPDATE user SET Password=PASSWORD('rootpassword') WHERE User='root';</div><div>mysql&gt; FLUSH PRIVILEGES;</div></div></blockquote><div><br /></div><div>とやれば変更できます。</div><div>変更した後は起動引数あるいは my.cnf から skip-grant-tables を消してから再起動すれば元通りになります。</div><div><br /></div><div>「引き継いだシステムの資料に root のパスワード書いてない！？」</div><div>とか、</div><div>「root のパスワードを変更する運用の際に typo して入れなくなった！？」</div><div>など</div><div><br /></div><div>そういった事が無ければあまり陥る状況ではないと思われますが、知っていれば安心ですね。</div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000027"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/27"
    dc:title="クエリログもバイナリログも吐いてないけど実行されているクエリを追いたいとき - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000027"
    dc:subject=""
    dc:description="MySQL Casual Talksおつかれさまでした。ようやくAdvent C..."
    dc:creator="myfinder"
    dc:date="2010-12-13T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-27" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-13.html" rel="bookmark">クエリログもバイナリログも吐いてないけど実行されているクエリを追いたいとき - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-13T00:00:00+09:00">2010年12月13日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-13.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-13.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            MySQL Casual Talksおつかれさまでした。<div>ようやくAdvent Calendarも後半折り返し地点くらいにきました。</div><div><br /></div><div>10日の記事で、binlog を開いてクエリを見る方法について書きましたが、今回は binlog すら出していない場合どうしたらいいかということについて書きたいと思います。</div><div>とはいえ、Casual Talks で riywo さんが挙げた tcpdump を使う手そのままではありますが。。</div><div><br /></div><div>単一のマスタのみでサービスを運用している場合、そもそも binlog を吐く設定になっていないということもあるんじゃないかと思います。</div><div>そういうときは諦めず、tcpdumpを使う事で実行されているクエリを読む事ができます。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div># tcpdump -s 0 -l -w - dst port 3306 | strings | perl -e '</div><div>while (&lt;&gt;) {</div><div>&nbsp;&nbsp;chomp;</div><div>&nbsp;&nbsp;next if /^[^ ]+[ ]+$/;</div><div>&nbsp;&nbsp;if (/^(UPDATE|DELETE|INSERT)/i) {</div><div>&nbsp;&nbsp; &nbsp;if (defined $q) {</div><div>&nbsp;&nbsp; &nbsp; &nbsp;print "$q\n";</div><div>&nbsp;&nbsp; &nbsp;}</div><div>&nbsp;&nbsp; &nbsp;$q = $_;</div><div>&nbsp;&nbsp;}</div><div>&nbsp;&nbsp;else {</div><div>&nbsp;&nbsp; &nbsp;$_ =~ s/^[ \t]+//;</div><div>&nbsp;&nbsp; &nbsp;$q .= " $_";</div><div>&nbsp;&nbsp;}</div><div>}'</div></div></blockquote><div><br /></div><div>こんな感じです。</div><div>但し更新が激しい場合しばらくターミナルへの操作が返ってこなかったりする事もあるので、その辺の制御はできるような状態で実施する事が望ましいです。</div><div><br /></div><div>正規表現の所にSELECTとか追加すれば、参照系クエリも見る事ができるのでこっちの手の方が使い道というか、幅は広いのではと思います。</div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000023"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/23"
    dc:title="MySQL Casual Talks Vol.1 開催報告 - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000023"
    dc:subject=""
    dc:description="昨日12/11(土)に、MySQL Casual Talks Vol.1 を開催..."
    dc:creator="myfinder"
    dc:date="2010-12-12T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-23" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-12.html" rel="bookmark">MySQL Casual Talks Vol.1 開催報告 - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-12T00:00:00+09:00">2010年12月12日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-12.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-12.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            昨日12/11(土)に、<a href="http://atnd.org/events/9803">MySQL Casual Talks Vol.1</a> を開催しました。<div>思いつきから始めたMySQL Casualですが、こうして一つイベントを行えたのも参加者の皆様の存在と、協力いただいた日本オラクルの甲木さんの助力のおかげです。</div><div>改めて感謝申し上げます。</div><div><br /></div><div>さて、12日は当日のスピーカーさんたちの資料をまとめるページとして、アップされ次第随時更新していきます。</div><div>以下一覧です。</div><div><br /></div><div><br /></div><div><ul><li><font class="Apple-style-span" style="font-size: 1.25em; ">myfinder : show innodb status</font></li></ul></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><a href="http://blog.myfinder.jp/2010/12/mysql-casual-talks-vol1.html">http://blog.myfinder.jp/2010/12/mysql-casual-talks-vol1.html</a></div></blockquote><div><ul><li><font class="Apple-style-span" style="font-size: 1.25em; ">riywo : xtrabackupとかtcpdumpとか(仮)</font></li></ul></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><a href="http://blog.riywo.com/2010/12/12/120211">http://blog.riywo.com/2010/12/12/120211</a></div></blockquote><div><ul><li><font class="Apple-style-span" style="font-size: 1.25em; ">kamipo :&nbsp;MySQL::Sandboxとか(仮)</font></li></ul></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><a href="http://d.hatena.ne.jp/kamipo/20101212/1292188972">http://d.hatena.ne.jp/kamipo/20101212/1292188972</a></div></blockquote><div><ul><li><font class="Apple-style-span" style="font-size: 1.25em; ">craftworks :&nbsp;MySQL 初めてのチューニング</font></li></ul></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><a href="http://d.hatena.ne.jp/Craftworks/20101211/1292067464">http://d.hatena.ne.jp/Craftworks/20101211/1292067464</a></div></blockquote><div><ul><li><font class="Apple-style-span" style="font-size: 1.25em; ">marqs :&nbsp;はてなでのMySQL運用(仮)</font></li></ul><br /></div><div><ul><li><font class="Apple-style-span" style="font-size: 1.25em; ">xaicron :&nbsp;たのしいMySQLデータ分割入門(仮)</font></li></ul></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><a href="http://blog.livedoor.jp/xaicron/archives/51206014.html">http://blog.livedoor.jp/xaicron/archives/51206014.html</a></div></blockquote><div><ul><li><font class="Apple-style-span" style="font-size: 1.25em; ">n_hayashi :&nbsp;online schema change(仮)</font></li></ul></div><div><br /></div><div><ul><li><font class="Apple-style-span" style="font-size: 1.25em; ">RKajiyama :&nbsp;MySQL5.5 最新動向</font></li></ul><br /></div><div><br /></div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000022"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/22"
    dc:title="MySQL Casual Talks Vol.1 開催です - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000022"
    dc:subject=""
    dc:description="本日12/11(土)&amp;nbsp;19:00〜は MySQL Casual Tal..."
    dc:creator="myfinder"
    dc:date="2010-12-11T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-22" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-11.html" rel="bookmark">MySQL Casual Talks Vol.1 開催です - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-11T00:00:00+09:00">2010年12月11日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-11.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-11.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            本日12/11(土)&nbsp;19:00〜は <a href="http://atnd.org/events/9803">MySQL Casual Talks Vol.1</a> を開催します。<div><br /></div><div>MySQL Casualを発足してすぐに「やりたい！」と思っており、仕事の都合やYAPCが近かった事などから延び延びになっていたところでしたがいよいよ実施の運びとなりました。</div><div><br /></div><div>会場を貸していただいた日本オラクルの<a href="http://twitter.com/yokatsuki">甲木さん</a>、スピーカーの皆様、参加者の皆様には感謝感謝であります。</div><div><br /></div><div>さて、会の内容ですが、atndにもありますとおり8名のスピーカーを集めてのTalkとなります。</div><div>現役バリバリのDBAから、プログラマ、MySQL本体の中の人まで幅広いトークがそろっています。</div><div><br /></div><div>参加される方も是非、いろいろなものを持ち帰ってもらえるような会になるよう運営をおこないたいと思いますので、よろしくお願いいたします。</div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000026"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/26"
    dc:title="クエリログを吐かせたくないけど実行されているクエリを追いたいとき - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000026"
    dc:subject=""
    dc:description="急にMasterに対してINSERTやUPDATE, DELETEが増えて負荷が..."
    dc:creator="myfinder"
    dc:date="2010-12-10T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-26" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-10.html" rel="bookmark">クエリログを吐かせたくないけど実行されているクエリを追いたいとき - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-10T00:00:00+09:00">2010年12月10日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-10.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-10.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            急にMasterに対してINSERTやUPDATE, DELETEが増えて負荷が上がっているけどどういうクエリが実行されてるかわからない。<div>などという時には、「クエリログ吐かせたい、でも再起動できないし吐かせたらデータ量が大変。。。」というときは mysqlbinlog コマンドの出番です。</div><div><br /></div><div>watchコマンド、tailコマンドを組み合わせて</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>watch -n1 'mysqlbinlog --no-defaults mysqld-bin.000001 | tail -n 30'&nbsp;</div></blockquote><div><br /></div><div>こんな感じで、最新のバイナリログの内容をtailできます。</div><div>特定のデータベースに対するログだけみたい、というときは「--database」オプションをつけるとよいでしょう。</div><div><br /></div><div>注意点として、「<span class="Apple-style-span" style="font-family: 'ＭＳ ゴシック', Osaka－等幅; font-size: 12px; line-height: 7px; white-space: pre; ">max_binlog_size</span>」の設定がデカイと、実行に時間がかかる&amp;poorな環境だとメモリ足りなくて開けないとかそういうことがあるので、ローテートファイルサイズには注意したいところです。</div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000025"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/25"
    dc:title="InnoDBにおけるデータ保全とO_DIRECTのこと - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000025"
    dc:subject=""
    dc:description="昨晩あるエンジニアの方と新宿の街を歩きながら、前回の記事と、sh2さんのエントリ..."
    dc:creator="myfinder"
    dc:date="2010-12-09T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-25" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-09.html" rel="bookmark">InnoDBにおけるデータ保全とO_DIRECTのこと - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-09T00:00:00+09:00">2010年12月 9日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-09.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-09.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            昨晩あるエンジニアの方と新宿の街を歩きながら、<a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-08.html">前回の記事</a>と、<a href="http://d.hatena.ne.jp/sh2/20101205">sh2さんのエントリ</a>ついて話をしました。<div>そのときに</div><div>WALのことと「O_DIRECTは基本的に設定しといて問題はなくて、どちらかというとバッファプールの取り方が状況によって変わる」</div><div>というような事を聞いたり話したりしました。(うろ覚えを書いているので訂正追加等あれば随時反映します)</div><div><br /></div><div><ul><li><font class="Apple-style-span" style="font-size: 1.25em; ">WALの仕組みおさらい</font></li></ul></div><div><br /></div><div>改めて、InnoDBのログ方法とクラッシュリカバリについておさらいします。</div><div><br /></div><div><ol><li>WALは、データ更新をメモリの log_buffere 領域に書き込む</li><li>innodb_flush_log_at_trx_commit の設定タイミングでトランザクションログに flush する。</li></ol></div><div><br /></div><div>この際、トランザクションログに記録されている内容については、テーブルデータに書き込まれていなくても、REDOログとしてディスクに残っており、クラッシュリカバリの際にテーブルデータに書き込まれるのでトランザクションの内容は保全されます。(但し、ストレージがバッテリーバックアップ等の保全機構のないライトバックキャッシュを利用している場合、ちゃんと書き込まれていなくても書き込まれたように振る舞うことがあるのでこの限りではないです)</div><div><br /></div><div>なので、テーブルデータに全部が常に保持されている状態を作る必要はなく、WALの機構によって保全できるという話でした。</div><div><br /></div><div><ul><li><font class="Apple-style-span" style="font-size: 1.25em; ">O_DIRECTで基本的に問題ない件</font></li></ul></div><div><br /></div><div>例えばWebサーバとDBが同居する場合、MySQL以外に激しくディスクI/Oを行うプロセスが存在する可能性があります。</div><div>そういう場合はO_DIRECTを用いず、innodb_buffere_pool_sizeを小さめにすることで、ディスクI/Oに関わるキャッシュをOS任せにできるのでよいでしょう、という話でした。</div><div><br /></div><div>しかしながら通常MySQLとWebサーバ等が同居する事はないので、基本O_DIRECTに設定する方がよいということでした。</div><div>運用上MySQLだけが動くサーバを準備できる環境の場合は、全てのデータがメモリに載る、あるいはSSDやFusion-io等のある程度のI/O発生でも高速に読み出せるストレージを備えたサーバさえあれば、OSのページキャッシュに頼らず、O_DIRECTに設定しておく方がメリットが大きいだろうということでした。</div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000024"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/24"
    dc:title="同期I/OまたはO_DIRECTって何だ？ - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000024"
    dc:subject=""
    dc:description="sh2さんのエントリで、innodb_flush_methodについての話があり..."
    dc:creator="myfinder"
    dc:date="2010-12-08T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-24" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-08.html" rel="bookmark">同期I/OまたはO_DIRECTって何だ？ - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-08T00:00:00+09:00">2010年12月 8日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-08.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-08.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <a href="http://d.hatena.ne.jp/sh2/20101205">sh2さんのエントリ</a>で、innodb_flush_methodについての話があり、O_DIRECTの設定について調べた事のまとめ。<div><br /></div><div><ul><li><font class="Apple-style-span" style="font-size: 1.25em; ">システムコール</font></li></ul></div><div>ファイルを開く、などOSの機能(より低いレイヤ)を呼び出す際に使う関数で、MySQLがファイルを開いたりする時にも使われています。</div><div>O_DIRECTは、このシステムコールのopen()の動作に影響を与えるフラグで、ページキャッシュを経由しないで読み書きを行う動作になるフラグです。</div><div><br /></div><div><meta charset="utf-8"><div><ul style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.75em; margin-left: 20px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-weight: normal; list-style-type: disc; list-style-position: outside; list-style-image: initial; background-repeat: no-repeat repeat; "><li style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-weight: normal; "><font class="Apple-style-span" size="3">同期I/O</font></li></ul></div></div><div>innodb_flush_methodは、基本的にどんな設定でも同期I/Oが使われます。</div><div>設定可能な値としてfdatasync, O_DSYNC, O_DIRECTの3つがあり、標準はfdatasyncが指定されるようです。</div><div><br /></div><div>どれも基本的には同期I/Oですが、それぞれで記憶媒体(ディスク等)への書き出す時の挙動が違っていて</div><div>&nbsp;- fdatasyncではfsyncがデバイスへの書き込みを</div><div>&nbsp;- O_DSYNCを使う場合はデバイスへの書き込みと付随するメタデータの書き込みを</div><div>&nbsp;- O_DIRECTを使う場合はダイレクトI/Oによってデバイスへ、ページキャッシュを経由しないで書き込みを</div><div>それぞれ行う。</div><div><br /></div><div><meta charset="utf-8"><div><div><ul style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.75em; margin-left: 20px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-weight: normal; list-style-type: disc; list-style-position: outside; list-style-image: initial; border-style: initial; border-color: initial; background-repeat: no-repeat repeat; "><li style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-weight: normal; border-style: initial; border-color: initial; "><font class="Apple-style-span" size="3">O_DIRECT設定にした方がいいと言われる理由</font></li></ul></div></div></div><div>InnoDBは、独自にバッファプールを持っており、OSのページキャッシュを経由すると2重キャッシュになって無意味だ、という考え方のもと、O_DIRECTを指定するとよい、という風に言われています。</div><div>(<a href="http://www.amazon.co.jp/Linux-DB-%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E6%A7%8B%E7%AF%89-%E9%81%8B%E7%94%A8%E5%85%A5%E9%96%80-Magazine-SELECTION/dp/4798120723">この本</a>参照)</div><div><br /></div><div><meta charset="utf-8"><div><div><div><ul style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.75em; margin-left: 20px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-weight: normal; list-style-type: disc; list-style-position: outside; list-style-image: initial; border-style: initial; border-color: initial; border-style: initial; border-color: initial; background-repeat: no-repeat repeat; "><li style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-weight: normal; border-style: initial; border-color: initial; border-style: initial; border-color: initial; "><font class="Apple-style-span" size="3">より安全な運用にしたい場合</font></li></ul></div></div></div></div><div>O_DIRECTはfsync相当のことをダイレクトI/Oでやるようなので、安全な書き込みという意味ではO_DSYNCを指定した方がよいのかなと思います。(ソースは追えてないので未検証)</div><div>また、書き込み方法以外にも、書き込みタイミングの指定がInnoDBの設定として存在していて、それはinnodb_flush_log_at_trx_commitという項目で、</div><div>&nbsp;- 0 : 毎秒</div><div>&nbsp;- 1 : commit毎</div><div>&nbsp;- 2 : ログファイルへの書き出し-&gt;毎秒, ディスクへの書き出し-&gt;commit毎</div><div>という挙動になるそうです。</div><div><br /></div><div>なので、データ保全という意味では、innodb_flush_methodをO_DSYNCに、innodb_flush_log_at_trx_commitを1に設定するのがよいのかなと考えられます。</div><div><br /></div><div><br /></div><meta charset="utf-8"><meta charset="utf-8"><div><br /></div><div><br /></div><div><br /></div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000021"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/21"
    dc:title="クエリの結果をHTMLで取る - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000021"
    dc:subject=""
    dc:description="管理ツール系の開発でありがちなのが、テーブルを検索した結果をHTMLで表示するこ..."
    dc:creator="myfinder"
    dc:date="2010-12-07T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-21" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-07.html" rel="bookmark">クエリの結果をHTMLで取る - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-07T00:00:00+09:00">2010年12月 7日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-07.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-07.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <div>管理ツール系の開発でありがちなのが、テーブルを検索した結果をHTMLで表示することです。</div><div>そしてやりがちなのが、Perl であれば selectall_arrayref とか selectall_hashref を for や while でぐるぐる回しながらHTMLを作ったり、あるいはそのデータをそのままテンプレートエンジンに渡して処理するなどです。</div><div><br /></div><div>凝った事をやるのであれば、そういった処理は必要でしょうが、そうでない場合はMySQL側にHTMLを作らせる事もできます。</div><div><br /></div><div>やり方は簡単で、mysql コマンドに「-H」オプションを渡すだけです。</div><div>「-h」だとホスト指定になっちゃうので注意のこと。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>$ mysql -umysql-casual -p -hmysql information_schema -H -e 'select * from USER_PRIVILEGES'</div><div>&lt;TABLE BORDER=1&gt;</div><div>&lt;TR&gt;&lt;TH&gt;GRANTEE&lt;/TH&gt;&lt;TH&gt;TABLE_CATALOG&lt;/TH&gt;&lt;TH&gt;PRIVILEGE_TYPE&lt;/TH&gt;&lt;TH&gt;IS_GRANTABLE&lt;/TH&gt;&lt;/TR&gt;</div><div>&lt;TR&gt;&lt;TD&gt;'mysql-casual'@'%'&lt;/TD&gt;&lt;TD&gt;NULL&lt;/TD&gt;&lt;TD&gt;USAGE&lt;/TD&gt;&lt;TD&gt;NO&lt;/TD&gt;&lt;/TR&gt;&lt;/TABLE&gt;</div></div></blockquote><div><br /></div>と、こんな感じでカジュアルにHTMLを取得できます。<div>使いどころは限られるかもしれませんが、心の片隅に置いておくと役立つときがあるかもしれません。</div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000020"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/20"
    dc:title="コマンドプロンプト表示をカスタマイズ - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000020"
    dc:subject=""
    dc:description="複数台のMySQLを対象に作業するときは、オペミスしないためにも「mysql&amp;g..."
    dc:creator="myfinder"
    dc:date="2010-12-06T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-20" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-06.html" rel="bookmark">コマンドプロンプト表示をカスタマイズ - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-06T00:00:00+09:00">2010年12月 6日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-06.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-06.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            複数台のMySQLを対象に作業するときは、オペミスしないためにも「mysql&gt;」というプロンプトをカスタマイズして、ホスト名等を表示させるべきです。<div>カスタマイズは prompt コマンドで簡単にできます。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>mysql&gt; prompt \U [\d] &gt;</div><div>PROMPT set to '\U [\d] &gt;'</div><div>root@localhost [(none)] &gt;use mysql</div><div>Reading table information for completion of table and column names</div><div>You can turn off this feature to get a quicker startup with -A</div><div><br /></div><div>Database changed</div><div>root@localhost [mysql] &gt;</div></div></blockquote><div><br /></div>という感じに。<div>指定可能なシーケンスは、<a href="http://dev.mysql.com/doc/refman/5.1/ja/mysql-commands.html">ここ</a>に一覧があります。<br /><div><div><br /></div><div>プロンプトのカスタマイズは便利ですが、毎回ログイン後に prompt コマンドを発行するのは面倒です。</div></div></div><div>そういうときには my.cnf に書いておくことで、自動的に適用可能です。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><span class="Apple-style-span" style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, sans-serif; line-height: 22px; "><div class="line number1 index0 alt2" style="background-color: white !important; "><code class="text plain" style="font-family: Consolas, 'Courier New', 'Dejavu Sans Mono', Courier, mono, serif; color: black !important; ">[mysql]</code></div><div class="line number2 index1 alt1" style="background-color: white !important; "><code class="text plain" style="font-family: Consolas, 'Courier New', 'Dejavu Sans Mono', Courier, mono, serif; color: black !important; ">prompt='\\u: [\\d] &gt; '</code></div></span></div></blockquote><div>&nbsp;</div><div>my.cnf　で設定するときはバックスラッシュを重ねないと、 \r などが改行コードとかぶってしまうので注意が必要です。</div><div>元に戻したくなった場合は、引数なしで prompt コマンドを実行すればリセットできます。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>mysql&gt; prompt \u: [\d] &gt;</div><div>PROMPT set to '\u: [\d] &gt;'</div><div>root: [mysql] &gt;prompt</div><div>Returning to default PROMPT of mysql&gt;</div><div>mysql&gt;</div></div></blockquote><br /><div><br /></div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000018"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/18"
    dc:title="show profileでフェーズごとの実行時間を見る - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000018"
    dc:subject=""
    dc:description="showコマンドはMySQLの設定や状態を見る事ができるものですが、あるクエリの..."
    dc:creator="myfinder"
    dc:date="2010-12-05T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-18" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-05.html" rel="bookmark">show profileでフェーズごとの実行時間を見る - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-05T00:00:00+09:00">2010年12月 5日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-05.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-05.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <div>showコマンドはMySQLの設定や状態を見る事ができるものですが、あるクエリのフェーズごとの実行時間を取る事もできます。</div><div><br /></div><div>やり方は下記のように行います。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>mysql&gt; set profiling = 1;</div><div>Query OK, 0 rows affected (0.00 sec)</div><div><br /></div><div>mysql&gt; select * from user;</div></div></blockquote><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;">〜〜〜</blockquote><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div><br /></div><div>mysql&gt; show profile;</div><div>+--------------------------------+----------+</div><div>| Status &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Duration |</div><div>+--------------------------------+----------+</div><div>| starting &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.000035 |</div><div>| checking query cache for query | 0.000042 |</div><div>| Opening tables &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.000016 |</div><div>| System lock &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.000006 |</div><div>| Table lock &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.000010 |</div><div>| init &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.000035 |</div><div>| optimizing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.000005 |</div><div>| statistics &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.000010 |</div><div>| preparing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.000008 |</div><div>| executing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.000004 |</div><div>| Sending data &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.000100 |</div><div>| end &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.000006 |</div><div>| query end &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.000004 |</div><div>| freeing items &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.000028 |</div><div>| logging slow query &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.000004 |</div><div>| cleaning up &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.000005 |</div><div>+--------------------------------+----------+</div><div>16 rows in set (0.00 sec)</div></div></blockquote><br /><div>こんな感じ。</div><div>profiling変数はセッションレベル(接続ごと)に持っているもので、これが有効になっている場合に上記のようなプロファイル結果を出してくれます。</div><div><br /></div><div>profiling変数が有効な間、実行したクエリのプロファイルは保持されているので、その一覧を見たい場合は</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>mysql&gt; show profiles;</div><div>+----------+------------+--------------------------+</div><div>| Query_ID | Duration &nbsp; | Query &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</div><div>+----------+------------+--------------------------+</div><div>| &nbsp; &nbsp; &nbsp; &nbsp;1 | 0.00086000 | select * from user |</div><div>〜〜〜〜</div><div>| &nbsp; &nbsp; &nbsp; &nbsp;8 | 0.00032300 | select * from user &nbsp; &nbsp; &nbsp; |</div><div>| &nbsp; &nbsp; &nbsp; &nbsp;9 | 0.00009400 | set profiling = 1 &nbsp; &nbsp; &nbsp; &nbsp;|</div><div>| &nbsp; &nbsp; &nbsp; 10 | 0.00031800 | select * from user &nbsp; &nbsp; &nbsp; |</div><div>+----------+------------+--------------------------+</div><div>10 rows in set (0.00 sec)</div></div></blockquote><div><br /></div>というshowコマンドで取得できます。<div>Query_IDを指定してプロファイル結果を見たい場合は</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>mysql&gt; show profile for query 7;</div><div>+--------------------------------+----------+</div><div>| Status &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Duration |</div><div>+--------------------------------+----------+</div><div>| starting &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.000033 |</div><div>| checking query cache for query | 0.000044 |</div><div>| Opening tables &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.000016 |</div><div>| System lock &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.000006 |</div><div>| Table lock &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.000010 |</div><div>| init &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.000093 |</div><div>| optimizing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.000006 |</div><div>| statistics &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.000011 |</div><div>| preparing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.000026 |</div><div>| executing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.000005 |</div><div>| Sending data &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.000106 |</div><div>| end &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.000006 |</div><div>| query end &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.000004 |</div><div>| freeing items &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.000028 |</div><div>| logging slow query &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.000004 |</div><div>| cleaning up &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.000005 |</div><div>+--------------------------------+----------+</div><div>16 rows in set (0.00 sec)</div></div></blockquote><div><br /></div>という感じにクエリ番号を指定すればOKです。<div><br /></div><div><meta charset="utf-8">すでにお気づきの事とは思いますが、プログラムからMySQLに接続する際にprofiling変数を有効にしておけば、接続している間に実行したSQLの細かなプロファイルを取得できます。</div><div>単に変数を有効化して接続を切る前にshowコマンドの結果を取得するだけでよいので、クエリのパフォーマンスにお悩みの方はそのような処理をアプリケーションに入れこむと解析がしやすくなるのではと思います。</div><div><br /></div><div>* 但しこれが使えるのは5.0.37以降のようです。</div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000019"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/19"
    dc:title="old_passwordsオプション - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000019"
    dc:subject=""
    dc:description="3日目の終わりに、「権限まわりのコマンドだったりそれによる挙動は5.0以降でも結..."
    dc:creator="myfinder"
    dc:date="2010-12-04T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-19" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-04.html" rel="bookmark">old_passwordsオプション - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-04T00:00:00+09:00">2010年12月 4日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-04.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-04.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-03.html">3日目</a>の終わりに、「<meta charset="utf-8"><span class="Apple-style-span" style="font-family: 'trebuchet ms'; ">権限まわりのコマンドだったりそれによる挙動は5.0以降でも結構バージョンによって 差異があったりする」という記述があったので、この辺の内容を引き続き。</span><div><span class="Apple-style-span" style="font-family: 'trebuchet ms'; "><br /></span></div><div><span class="Apple-style-span" style="font-family: 'trebuchet ms'; ">MySQL 4.1 から、より安全性の高いパスワードハッシュ方式に変更されています。</span></div><div><span class="Apple-style-span" style="font-family: 'trebuchet ms'; ">このため、古いクライアントプログラムから新しいパスワードハッシュ方式を使っているDBへ接続しようとすると、パスワード認証が通らなくなってしまいます。</span></div><div><span class="Apple-style-span" style="font-family: 'trebuchet ms'; "><br /></span></div><div><font class="Apple-style-span" face="'trebuchet ms'">クライアントプログラムが新しい環境であれば、この点は意識しなくても問題ないのですが、歴史ある環境だとそうも行かないケースがあったりするのではないでしょうか。</font></div><div><font class="Apple-style-span" face="'trebuchet ms'"><br /></font></div><div><font class="Apple-style-span" face="'trebuchet ms'">そういった場合は、古いクライアントプログラムからも利用可能なように、MySQLに設定を追加する必要があります。</font></div><div><font class="Apple-style-span" face="'trebuchet ms'">それが old_passwords オプションで、この設定を行えば、古いクライアントプログラムからの認証要求も通るようになります。</font></div><div><font class="Apple-style-span" face="'trebuchet ms'"><br /></font></div><div><font class="Apple-style-span" face="'trebuchet ms'">設定は簡単で、 my.cnf に「old-passwords」と一行記述しておくだけです。</font></div><div><font class="Apple-style-span" face="'trebuchet ms'">現在の設定は、下記コマンドで確認できます。</font></div><div><font class="Apple-style-span" face="'trebuchet ms'"><br /></font></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><font class="Apple-style-span" face="'trebuchet ms'"><div>mysql&gt; select @@old_passwords;</div><div>+-----------------+</div><div>| @@old_passwords |</div><div>+-----------------+</div><div>| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 |</div><div>+-----------------+</div><div>1 row in set (0.00 sec)</div></font></div></blockquote><div><font class="Apple-style-span" face="'trebuchet ms'"><br /></font></div><div><font class="Apple-style-span" face="'trebuchet ms'">MySQL 4.0が混在するような環境の場合、この設定でハマるケースがあるので、そのような環境にいらっしゃる方はご注意くださいませ。</font></div><div><font class="Apple-style-span" face="'trebuchet ms'"><br /></font></div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000017"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/17"
    dc:title="ユーザ設定入門 - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000017"
    dc:subject=""
    dc:description="「MySQLを使ってみようか」と思った人にとって、インストールの次に困るのがユー..."
    dc:creator="riywo"
    dc:date="2010-12-03T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-17" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-03.html" rel="bookmark">ユーザ設定入門 - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">riywo</span> (<abbr class="published" title="2010-12-03T00:00:00+09:00">2010年12月 3日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-03.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-03.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>「MySQLを使ってみようか」と思った人にとって、インストールの次に困るのがユーザ設定の部分だと思います。
SQLiteとかをカジュアルに使いたくなるのは、ファイル1枚で管理が楽というのに加えて、
ユーザの設定が必要なくてすぐに利用できるという点がある様な気がしてます。</p>

<p>ただ、当然サービスレベルのアプリケーションを作っていく時にはどうしてもRDBMSを使うことになると
思いますので、ここではMySQLでのユーザ設定の入門を簡単に説明したいと思います。</p>

<p>RHELのCommunity版rpmを入れただけの場合、デフォルトのユーザはこんな感じです。</p>

<pre>
mysql> select user,host,password from mysql.user;
+------+-----------+----------+
| user | host      | password |
+------+-----------+----------+
| root | localhost |          |
| root | HOSTNAME     |          |
| root | 127.0.0.1 |          |
|      | localhost |          |
|      | HOSTNAME     |          |
+------+-----------+----------+
</pre>

<p>細かいことは鍵本などを見て頂くとして、基本的にアカウントは「ユーザ名＠接続元ホスト名」の様な感じで
管理されています。上の結果を見ると、ユーザ名がrootか空っぽ、ホスト名は色々ありますが基本localhostからの
接続のみができる様になっているようです。パスワードは全部空っぽ。rootとかいうユーザなのにパスワード無しで
入れてしまうんですね。</p>

<pre>
$ mysql -uroot
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 7
Server version: 5.1.50-community MySQL Community Server (GPL)

Copyright (c) 2000, 2010, Oracle and/or its affiliates. All rights reserved.
This software comes with ABSOLUTELY NO WARRANTY. This is free software,
and you are welcome to modify and redistribute it under the GPL v2 license

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> drop database oracle;  ←ウホ！
</pre>

<p>怖いですね。これではOracleに怒られます。</p>

<p>また、webアプリケーションとか作る時はWEBサーバとDBサーバは別ホストにあることが多いと思いますので
このままだとそもそもWEBサーバから接続できません。匿名でアクセスできるというのも気持ち悪いですね。</p>

<p>とりあえず簡単に綺麗にするには、MySQL付属のmysql<em>secure</em>installコマンドを使いましょう。</p>

<pre>
$ mysql_secure_installation
Enter current password for root (enter for none):  (今は空なのでenter)

Set root password? [Y/n] y   ←rootのパスワードを設定します
New password:
Re-enter new password:

Remove anonymous users? [Y/n] y  ←匿名ユーザを削除します

Disallow root login remotely? [Y/n] y  ←今はroot@HOSTNAMEが消えるだけ。

Remove test database and access to it? [Y/n] y ←デフォルトで作られるtestデータベースを消します

Reload privilege tables now? [Y/n] y  ←上記権限設定をメモリ上に反映させます


$ mysql -uroot -pPASSWORD  ←パスワードを直接書く場合、-pの後にスペースを入れない様に
mysql> select user,host,password from mysql.user;
+------+-----------+-------------------------------------------+
| user | host      | password                                  |
+------+-----------+-------------------------------------------+
| root | localhost | *AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA |
| root | 127.0.0.1 | *AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA |
+------+-----------+-------------------------------------------+

mysql> show grants for 'root'@'localhost';
+----------------------------------------------------------------------------------------------------------------------------------------+
| Grants for root@localhost                                                                                                              |
+----------------------------------------------------------------------------------------------------------------------------------------+
| GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' IDENTIFIED BY PASSWORD '*AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' WITH GRANT OPTION |
+----------------------------------------------------------------------------------------------------------------------------------------+
</pre>

<p>ひとまずすっきりしました。ここから先はご自分の環境のポリシーによると思いますが、
僕のおすすめは以下のようなユーザを作成すると良いかなと思います。そしてこの設定をデフォルトとして
どのMySQLサーバでも使い回す感じにすると楽チンです。</p>

<ul>
<li>リモートからもrootで入れる様にする
<ul>
<li>セキュリティ的には甘くなりますが、サーバが多いといちいちOSにログインするのが面倒なことも多いです。</li>
<li>ファイアウォールで外に3306ポートを開けなければ、あまりうるさくなることでもないかと思います。</li>
</ul></li>
<li>アプリケーション用のデータベースを操作できるユーザを作成する
<ul>
<li>専用のユーザを作っておくことで、まぁ無いとは思いますがアプリからroot的操作をされない様にしましょう。</li>
<li>master/slave構成を行う時はmasterにのみ書き込み操作などができるユーザを作るとなおよし。</li>
</ul></li>
<li>レプリケーション用のユーザを作成する
<ul>
<li>MySQLを使う場合、レプリケーションを組むことが多いと思いますが、master/slaveに限らずレプリ用のユーザはとりあえず作っておくと、Art of Replication的に便利だと思います。</li>
</ul></li>
</ul>

<p>というわけで、それぞれ以下の様な感じのSQLで作っていきます。rootでログインして実行しましょう。</p>

<pre>
mysql> grant all privileges on *.* to 'root'@'%' identified by 'password' with grant option;
mysql> create user 'write'@'%' identified by 'pass1';  (masterの場合のみ)
mysql> grant all on `db`.* to 'write'@'%';  (masterの場合のみ)
mysql> create user 'read'@'%' identified by 'pass2';
mysql> grant select on `db`.* to 'read'@'%';
mysql> grant replication slave on *.* to 'repli'@'%' identified by 'pass3';

+---------------------------------------------------------------------------------------+
| GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY PASSWORD '' WITH GRANT OPTION |
+---------------------------------------------------------------------------------------+
| GRANT USAGE ON *.* TO 'write'@'%' IDENTIFIED BY PASSWORD ''                           |
| GRANT ALL PRIVILEGES ON `db`.* TO 'write'@'%'                                         |
+---------------------------------------------------------------------------------------+
| GRANT USAGE ON *.* TO 'read'@'%' IDENTIFIED BY PASSWORD ''                            |
| GRANT SELECT PRIVILEGES ON `db`.* TO 'read'@'%'                                       |
+---------------------------------------------------------------------------------------+
| GRANT REPLICATION SLAVE ON *.* TO 'repli'@'%' IDENTIFIED BY PASSWORD ''               |
+---------------------------------------------------------------------------------------+
</pre>

<p>hostを%にすると、どこからでも接続できる様になります。これもセキュリティ的にはイマイチかもですが、
WEBサーバが増える毎に全DBサーバでユーザを追加するというのは管理的には現実的ではない気がします。</p>

<p>これで設定おわりです。これらの情報はmysqlという名前のデータベースに保存されていて、
ストレージエンジンはMyISAMです。同じバージョンのMySQLを使うのであれば、
次にセットアップしたDBサーバには、mysqlデータベースのファイルをコピーしてあげるだけで
同様の設定にできるので楽チンですね。もちろん上記オペレーションをセットアップスクリプトみたいなので
実行してもいいと思います。</p>

<p>あとは、これらパスワードの管理にだけ注意して下さい。3306ポートが接続できて、ユーザ名とパスワードが
漏れてしまうと楽々入れてしまいます。セキュアにする部分をMySQLだけで頑張るのは結構大変なので
原則ネットワーク的に守られた環境に置くのがベターだと思います。</p>

<p>あと、この辺の権限まわりのコマンドだったりそれによる挙動は5.0以降でも結構バージョンによって
差異があったりするので、どこかの解説とかをあまり鵜呑みにせずに、実際に自分の使ってるバージョンで
叩いてみて動作を確認してからサービスで使うようにしましょう。甘く見てると泣きをみます＞＜</p>

<p>God bress your MySQL!</p>

        </div>



        <div class="asset-more-link">
            続きを読む: <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-03.html#more" rel="bookmark">ユーザ設定入門 - MySQL Casual Advent Calendar 2010</a>
        </div>

    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000016"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/16"
    dc:title="showコマンド - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000016"
    dc:subject=""
    dc:description="showコマンドはMySQLの設定状況を確認したりプロセスを確認したりするのに使..."
    dc:creator="myfinder"
    dc:date="2010-12-02T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-16" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-02.html" rel="bookmark">showコマンド - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-02T00:00:00+09:00">2010年12月 2日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-02.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-02.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            showコマンドはMySQLの設定状況を確認したりプロセスを確認したりするのに使います。<div><br /></div><div><font class="Apple-style-span" style="font-size: 1.25em; "><font class="Apple-style-span" style="font-size: 1.25em; "><font class="Apple-style-span" style="font-size: 0.8em; ">1. 設定値を見る</font></font></font></div><div><br /></div><div>例えば設定値を見る show variables; だと以下のような感じです。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>mysql&gt; show global variables;</div><div>+-----------------------------------------+-------------------------+</div><div>| Variable_name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Value &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</div><div>+-----------------------------------------+-------------------------+</div><div>| auto_increment_increment &nbsp; &nbsp;| 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</div><div>| auto_increment_offset &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</div><div>| autocommit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | ON &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</div><div>| automatic_sp_privileges &nbsp; &nbsp; &nbsp; | ON &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</div><div>| back_log &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 50 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</div></div><div>〜〜〜〜〜〜〜〜〜〜〜〜<meta charset="utf-8">〜〜〜〜〜〜〜〜〜〜</div><meta charset="utf-8"><br /></blockquote><meta charset="utf-8"><meta charset="utf-8"><div>単純に show global variables; すると、300件弱の設定がずらずら出てきて流れてしまうので、見たい項目がわかっている場合はlike句で絞り込めます。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>mysql&gt; show global variables like 'version%';</div><div>+-------------------------+------------------------------+</div><div>| Variable_name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Value &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</div><div>+-------------------------+------------------------------+</div><div>| version &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 5.1.51-log &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</div><div>| version_comment &nbsp; &nbsp; &nbsp; &nbsp; | MySQL Community Server (GPL) |</div><div>| version_compile_machine | x86_64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</div><div>| version_compile_os &nbsp; &nbsp; &nbsp;| unknown-linux-gnu &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</div><div>+-------------------------+------------------------------+</div><div>4 rows in set (0.00 sec)</div></div></blockquote><div><br /></div><div>こんな感じに。</div><div>見たい項目が一つだけで、変数名がわかっている場合は select @@variables; で引く事ができます。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>mysql&gt; select @@version;</div><div>+------------+</div><div>| @@version &nbsp;|</div><div>+------------+</div><div>| 5.1.51-log |</div><div>+------------+</div><div>1 row in set (0.00 sec)</div></div></blockquote><div><br /></div><div><font class="Apple-style-span" style="font-size: 1.25em; "><font class="Apple-style-span" style="font-size: 1.25em; "><font class="Apple-style-span" style="font-size: 0.8em; ">2. ステータス変数を見る</font></font></font></div><div><br /></div><div>他にMySQLはステータス変数を持っており、これらは show status; コマンドで見られます。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>mysql&gt; show global status;</div><div>+-----------------------------------+----------+</div><div>| Variable_name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Value &nbsp; &nbsp;|</div><div>+-----------------------------------+----------+</div><div>| Aborted_clients &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0 &nbsp; &nbsp; &nbsp; &nbsp;|</div><div>| Aborted_connects &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0 &nbsp; &nbsp; &nbsp; &nbsp;|</div><div>| Binlog_cache_disk_use &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0 &nbsp; &nbsp; &nbsp; &nbsp;|</div><div>| Binlog_cache_use &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0 &nbsp; &nbsp; &nbsp; &nbsp;|</div><div>| Bytes_received &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 212 &nbsp; &nbsp; &nbsp;|</div><div>| Bytes_sent &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 8431 &nbsp; &nbsp; |</div></div><div>〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜</div></blockquote><div><br /></div><div>show statusもlike句で絞り込めるので、欲しい情報だけを絞り込みたいときはlikeを使うのがよいでしょう。</div><div><br /></div><div><font class="Apple-style-span" style="font-size: 1.25em; ">3. テーブルやデータベースの状態を見る</font></div><div><br /></div><div>show databases; や show tables; 等で、データベースやテーブル一覧が見られますが、それらの状態を見るのにもshowコマンドを使います。</div><div><br /></div><div>例えばテーブルに対してどの程度ロックが掛かっているか、ロック待ちのスレッドがあるかなどを見るには show open tables; を使います。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>mysql&gt; show open tables;</div><div>+----------+--------------+--------+-------------+</div><div>| Database | Table &nbsp; &nbsp; &nbsp; &nbsp;| In_use | Name_locked |</div><div>+----------+--------------+--------+-------------+</div><div>| mysql &nbsp; &nbsp;| servers &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 |</div><div>| mysql &nbsp; &nbsp;| db &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 |</div><div>| mysql &nbsp; &nbsp;| host &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 |</div><div>| mysql &nbsp; &nbsp;| columns_priv | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 |</div><div>| mysql &nbsp; &nbsp;| user &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 |</div><div>| mysql &nbsp; &nbsp;| procs_priv &nbsp; | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 |</div><div>| mysql &nbsp; &nbsp;| event &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 |</div><div>| mysql &nbsp; &nbsp;| tables_priv &nbsp;| &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 |</div><div>+----------+--------------+--------+-------------+</div><div>8 rows in set (0.00 sec)</div></div></blockquote><div><br /></div><div>In_use がテーブルに対してロックをかけている、あるいはロック待ちのスレッド数を、Name_lockedがテーブル名に対してロックが掛けられている数を示しています。</div><div><br /></div><div>他にも状態把握のためのshowコマンドはいろいろとあるので、状況に合わせて活用したいですね。</div><div><ul><li>show procedure status; # ストアドプロシージャの一覧</li><li>show triggers; # useしたデータベース内のトリガ一覧</li><li>show events; # useしたデータベース内のイベントスケジューラ用イベント一覧</li><li>などなど</li></ul></div><div><br /></div><div><meta charset="utf-8"><div><font class="Apple-style-span" style="font-size: 1.25em; ">4. テーブルの状態をもっと詳しく見る</font></div></div><div><br /></div><div>show table status; を用いると、もっと詳しいテーブルの状態を取得できます。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>mysql&gt; show table status like "mt_asset"\G</div><div>*************************** 1. row ***************************</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Name: mt_asset</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; Engine: MyISAM</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;Version: 10</div><div>&nbsp;&nbsp; &nbsp; Row_format: Dynamic</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rows: 1</div><div>&nbsp;Avg_row_length: 112</div><div>&nbsp;&nbsp; &nbsp;Data_length: 112</div><div>Max_data_length: 281474976710655</div><div>&nbsp;&nbsp; Index_length: 21504</div><div>&nbsp;&nbsp; &nbsp; &nbsp;Data_free: 0</div><div>&nbsp;Auto_increment: 2</div><div>&nbsp;&nbsp; &nbsp;Create_time: 2010-07-17 12:27:50</div><div>&nbsp;&nbsp; &nbsp;Update_time: 2010-07-17 18:22:17</div><div>&nbsp;&nbsp; &nbsp; Check_time: 2010-07-17 12:27:50</div><div>&nbsp;&nbsp; &nbsp; &nbsp;Collation: utf8_general_ci</div><div>&nbsp;&nbsp; &nbsp; &nbsp; Checksum: NULL</div><div>&nbsp;Create_options:&nbsp;</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;Comment:&nbsp;</div><div>1 row in set (0.02 sec)</div></div></blockquote><div><br /></div><div>Data_lengthやIndex_lengthは特にテーブルスペース消費状況やデータサイズを知るために重要な指標になるでしょう。</div><div>他には show columns; や show create table; で、カラム一覧やスキーマ定義を知る事ができます。</div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>mysql&gt; show columns from mt_asset;</div><div>+-------------------+--------------+------+-----+---------+----------------+</div><div>| Field &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Type &nbsp; &nbsp; &nbsp; &nbsp; | Null | Key | Default | Extra &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</div><div>+-------------------+--------------+------+-----+---------+----------------+</div><div>| asset_id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| int(11) &nbsp; &nbsp; &nbsp;| NO &nbsp; | PRI | NULL &nbsp; &nbsp;| auto_increment |&nbsp;</div><div>| asset_blog_id &nbsp; &nbsp; | int(11) &nbsp; &nbsp; &nbsp;| NO &nbsp; | MUL | NULL &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</div><div>| asset_class &nbsp; &nbsp; &nbsp; | varchar(255) | YES &nbsp;| MUL | file &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</div><div>| asset_created_by &nbsp;| int(11) &nbsp; &nbsp; &nbsp;| YES &nbsp;| MUL | NULL &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</div><div>| asset_created_on &nbsp;| datetime &nbsp; &nbsp; | YES &nbsp;| MUL | NULL &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</div><div>| asset_description | mediumtext &nbsp; | YES &nbsp;| &nbsp; &nbsp; | NULL &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</div><div>| asset_file_ext &nbsp; &nbsp;| varchar(20) &nbsp;| YES &nbsp;| MUL | NULL &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</div><div>| asset_file_name &nbsp; | varchar(255) | YES &nbsp;| &nbsp; &nbsp; | NULL &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</div><div>| asset_file_path &nbsp; | varchar(255) | YES &nbsp;| &nbsp; &nbsp; | NULL &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</div><div>| asset_label &nbsp; &nbsp; &nbsp; | varchar(255) | YES &nbsp;| MUL | NULL &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</div><div>| asset_mime_type &nbsp; | varchar(255) | YES &nbsp;| &nbsp; &nbsp; | NULL &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</div><div>| asset_modified_by | int(11) &nbsp; &nbsp; &nbsp;| YES &nbsp;| &nbsp; &nbsp; | NULL &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</div><div>| asset_modified_on | datetime &nbsp; &nbsp; | YES &nbsp;| &nbsp; &nbsp; | NULL &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</div><div>| asset_parent &nbsp; &nbsp; &nbsp;| int(11) &nbsp; &nbsp; &nbsp;| YES &nbsp;| MUL | NULL &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</div><div>| asset_url &nbsp; &nbsp; &nbsp; &nbsp; | varchar(255) | YES &nbsp;| &nbsp; &nbsp; | NULL &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</div><div>+-------------------+--------------+------+-----+---------+----------------+</div><div>15 rows in set (0.02 sec)</div></div><div><br /></div><div><div>mysql&gt; show create table mt_asset\G</div><div>*************************** 1. row ***************************</div><div>&nbsp;&nbsp; &nbsp; &nbsp; Table: mt_asset</div><div>Create Table: CREATE TABLE `mt_asset` (</div><div>&nbsp;&nbsp;`asset_id` int(11) NOT NULL AUTO_INCREMENT,</div><div>&nbsp;&nbsp;`asset_blog_id` int(11) NOT NULL,</div><div>&nbsp;&nbsp;`asset_class` varchar(255) DEFAULT 'file',</div><div>&nbsp;&nbsp;`asset_created_by` int(11) DEFAULT NULL,</div><div>&nbsp;&nbsp;`asset_created_on` datetime DEFAULT NULL,</div><div>&nbsp;&nbsp;`asset_description` mediumtext,</div><div>&nbsp;&nbsp;`asset_file_ext` varchar(20) DEFAULT NULL,</div><div>&nbsp;&nbsp;`asset_file_name` varchar(255) DEFAULT NULL,</div><div>&nbsp;&nbsp;`asset_file_path` varchar(255) DEFAULT NULL,</div><div>&nbsp;&nbsp;`asset_label` varchar(255) DEFAULT NULL,</div><div>&nbsp;&nbsp;`asset_mime_type` varchar(255) DEFAULT NULL,</div><div>&nbsp;&nbsp;`asset_modified_by` int(11) DEFAULT NULL,</div><div>&nbsp;&nbsp;`asset_modified_on` datetime DEFAULT NULL,</div><div>&nbsp;&nbsp;`asset_parent` int(11) DEFAULT NULL,</div><div>&nbsp;&nbsp;`asset_url` varchar(255) DEFAULT NULL,</div><div>&nbsp;&nbsp;PRIMARY KEY (`asset_id`),</div><div>&nbsp;&nbsp;KEY `mt_asset_blog_class_date` (`asset_blog_id`,`asset_class`,`asset_created_on`),</div><div>&nbsp;&nbsp;KEY `mt_asset_parent` (`asset_parent`),</div><div>&nbsp;&nbsp;KEY `mt_asset_file_ext` (`asset_file_ext`),</div><div>&nbsp;&nbsp;KEY `mt_asset_created_on` (`asset_created_on`),</div><div>&nbsp;&nbsp;KEY `mt_asset_class` (`asset_class`),</div><div>&nbsp;&nbsp;KEY `mt_asset_label` (`asset_label`),</div><div>&nbsp;&nbsp;KEY `mt_asset_created_by` (`asset_created_by`)</div><div>) ENGINE=MyISAM AUTO_INCREMENT=2 DEFAULT CHARSET=utf8</div><div>1 row in set (0.02 sec)</div></div></blockquote><div><br /></div><div>他にも show grants; で権限を、 show master status; や show slave status; でレプリケーションの状態を取得するなど、showコマンドはMySQLの状態を多岐にわたって取得できるコマンドなので、必要なときにさっと必要な情報を取り出せるようになりたいところです。</div><div><br /></div><div><br /></div><div><br /></div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://mysql-casual.org/2010/12/index.html#entry-000015"
    trackback:ping="http://mysql-casual.org/cgi-bin/mt/mt-tb.cgi/15"
    dc:title="mysqld_safeって何だ - MySQL Casual Advent Calendar 2010"
    dc:identifier="http://mysql-casual.org/2010/12/index.html#entry-000015"
    dc:subject=""
    dc:description="CentOSなどで、MySQLの提供するrpmをインストールして使っている場合、..."
    dc:creator="myfinder"
    dc:date="2010-12-01T00:00:00+09:00" />
</rdf:RDF>
-->

<div id="entry-15" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-01.html" rel="bookmark">mysqld_safeって何だ - MySQL Casual Advent Calendar 2010</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <span class="vcard author">myfinder</span> (<abbr class="published" title="2010-12-01T00:00:00+09:00">2010年12月 1日 00:00</abbr>)
    
            </span>

            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-01.html#comments">コメント(0)</a>
            <span class="separator">|</span> <a href="http://mysql-casual.org/2010/12/mysql-casual-advent-calendar-2010-12-01.html#trackbacks">トラックバック(0)</a>

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            CentOSなどで、MySQLの提供するrpmをインストールして使っている場合、付属のスクリプトはmysqld_safeを起動し、mysqld_safeからmysqldが起動する構成になっています。<div>pstreeで見ると下記のような感じになっていると思います。<br /><div><div><br /></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>init─┬─acpid</div><div>&nbsp;〜〜〜</div><div>&nbsp;&nbsp; &nbsp; ├─mysqld_safe───mysqld───9*[{mysqld}]</div><div>&nbsp;〜〜〜</div></div></blockquote><div><br /></div><div>このmysqld_safeが何をしてくれているかというと、MySQLのプロセスがダウンしたときの自動的な再起動や、エラーログを「ホスト名.err」吐くようにしてくれたりします。</div><div><br /></div><div>例えば kill -KILL などでMySQLを落とした場合、エラーログに下記のように出力され、再起動が掛かります。</div><div><br /></div></div></div><blockquote class="webkit-indent-blockquote" style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div><div><div>101201 01:24:59 mysqld_safe Number of processes running now: 0</div><div>101201 01:24:59 mysqld_safe mysqld restarted</div></div></div></div></blockquote><div><div><div><br /></div><div>mysqld単独で起動した場合、プロセスがダウンしても再起動してくれないばかりか、ログも標準出力に消えて行くので、あまりうれしい事がありません。</div><div><br /></div><div>時折MySQLをdaemontoolsで管理するといった記事を見かけますが、multilogでがんばろうとか考えたりしない限りはmysqld_safeの力を借りた方が楽でしょう。</div></div></div>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="http://mysql-casual.org/2010/11/">&laquo; 2010年11月</a> |
                                <a href="http://mysql-casual.org/">メインページ</a> |
                                <a href="http://mysql-casual.org/archives.html">アーカイブ</a>
                                | <a href="http://mysql-casual.org/2011/07/">2011年7月 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-search widget">
    <h3 class="widget-header">検索</h3>
    <div class="widget-content">
        <form method="get" action="http://mysql-casual.org/cgi-bin/mt/mt-search.cgi">
            <input type="text" id="search" class="ti" name="search" value="" />

            <input type="hidden" name="IncludeBlogs" value="2" />

            <input type="hidden" name="limit" value="20" />
            <input type="submit" accesskey="4" value="検索" />
        </form>
    </div>
</div>

<div class="widget-archive widget-archive-category widget">
    <h3 class="widget-header">カテゴリ</h3>
    <div class="widget-content">
    
    </div>
</div>




    <div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">月別 <a href="http://mysql-casual.org/archives.html">アーカイブ</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="http://mysql-casual.org/2019/07/">2019年7月 (1)</a></li>
        
    
        
            <li><a href="http://mysql-casual.org/2011/07/">2011年7月 (1)</a></li>
        
    
        
            <li><a href="http://mysql-casual.org/2010/12/">2010年12月 (26)</a></li>
        
    
        
            <li><a href="http://mysql-casual.org/2010/11/">2010年11月 (1)</a></li>
        
    
        
            <li><a href="http://mysql-casual.org/2010/08/">2010年8月 (3)</a></li>
        
    
        
            <li><a href="http://mysql-casual.org/2010/07/">2010年7月 (3)</a></li>
        
        </ul>
    </div>
</div>
        
    



<div class="widget-pages widget">
    <h3 class="widget-header">ウェブページ</h3>
    <div class="widget-content">
        <ul>
    
    
        </ul>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="http://mysql-casual.org/mt-static/images/status_icons/feed.gif" alt="購読する" width="9" height="9" /> <a href="http://mysql-casual.org/atom.xml">このブログを購読</a></li>

        </ul>
    </div>
</div>
<div class="widget-openid widget">
    <div class="widget-content">
        <em><strong>OpenID</strong>対応しています</em>
        <a href="http://www.movabletype.jp/openid/">OpenIDについて</a>
    </div>
</div>

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.sixapart.jp/movabletype/"><img src="http://mysql-casual.org/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.02" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.sixapart.jp/movabletype/">Movable Type</a>
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
